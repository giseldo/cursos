# Projeto Pr√°tico - Servidor HTTP Simples

:::info
Criado por Kleber Galv√£o.
:::

Bem-vindo ao **Projeto Pr√°tico** do **M√≥dulo 1: Fundamentos do Node.js** do curso **Node.js do B√°sico ao Avan√ßado**! Nesta aula, voc√™ colocar√° em pr√°tica os conceitos aprendidos nas aulas anteriores, criando um servidor HTTP simples usando o m√≥dulo nativo `http` do Node.js. O projeto inclui a implementa√ß√£o de rotas GET para as p√°ginas inicial (`/`), sobre (`/about`) e contato (`/contact`), al√©m de um **Desafio Avan√ßado** que adiciona uma rota para ler e retornar o conte√∫do de um arquivo JSON.

O objetivo √© consolidar sua compreens√£o sobre como o Node.js lida com requisi√ß√µes HTTP, como estruturar um servidor b√°sico e como integrar manipula√ß√£o de arquivos com o m√≥dulo `fs`. O material √© dividido em duas partes: o **Projeto Principal**, que implementa o servidor com as rotas especificadas, e o **Desafio Avan√ßado**, que estende a funcionalidade com leitura de arquivos JSON. O conte√∫do √© pr√°tico, com exemplos comentados, boas pr√°ticas e explica√ß√µes detalhadas para garantir um aprendizado s√≥lido.

---

## Introdu√ß√£o ao Projeto

O m√≥dulo `http` do Node.js permite criar servidores web que respondem a requisi√ß√µes HTTP, como GET, POST, entre outros. Neste projeto, voc√™ criar√° um servidor que:

- Escuta na porta 3000.
- Responde a requisi√ß√µes GET nas rotas `/`, `/about` e `/contact` com mensagens de texto.
- Retorna um erro 404 para rotas desconhecidas.
- (No Desafio Avan√ßado) L√™ um arquivo JSON e retorna seu conte√∫do em uma rota `/data`.

Este projeto √© uma introdu√ß√£o pr√°tica √† constru√ß√£o de servidores web com Node.js, preparando voc√™ para t√≥picos mais avan√ßados, como APIs RESTful com Express. Vamos usar o m√≥dulo `http` para manter a simplicidade e focar nos fundamentos, e o m√≥dulo `fs` (File System) para o Desafio Avan√ßado.

### Objetivos do Projeto

- Criar um servidor HTTP funcional com o m√≥dulo `http`.
- Implementar rotas GET b√°sicas (`/`, `/about`, `/contact`).
- Lidar com erros (ex.: 404 para rotas inv√°lidas).
- (Desafio Avan√ßado) Integrar leitura de arquivos JSON com o m√≥dulo `fs`.
- Aplicar boas pr√°ticas, como organiza√ß√£o de c√≥digo, tratamento de erros e versionamento com Git.

### Pr√©-requisitos

- Node.js (vers√£o LTS, v20.x ou superior em 2025) instalado.
- Visual Studio Code (VS Code) configurado com extens√µes recomendadas (ESLint, Prettier).
- Conhecimento b√°sico de JavaScript e do m√≥dulo `http` (conforme a aula de Introdu√ß√£o ao Node.js).
- Um projeto Node.js inicializado com `npm init -y`.

---

## Projeto Principal: Criando o Servidor HTTP Simples

### Passo 1: Configurar o Projeto

1. **Criar a Pasta do Projeto**:
   Crie uma nova pasta para o projeto e inicialize o `package.json`:
   ```bash
   mkdir servidor-http-simples
   cd servidor-http-simples
   npm init -y
   ```

2. **Verificar o `package.json`**:
   O comando `npm init -y` cria um `package.json` com valores padr√£o:
   ```json
   {
     "name": "servidor-http-simples",
     "version": "1.0.0",
     "description": "",
     "main": "index.js",
     "scripts": {
       "test": "echo \"Error: no test specified\" && exit 1"
     },
     "keywords": [],
     "author": "",
     "license": "ISC"
   }
   ```

3. **Adicionar Scripts e Nodemon**:
   Instale o `nodemon` para reiniciar o servidor automaticamente durante o desenvolvimento:
   ```bash
   npm install --save-dev nodemon
   ```
   Atualize o `package.json` com scripts √∫teis:
   ```json
   "scripts": {
     "start": "node index.js",
     "dev": "nodemon index.js"
   }
   ```

4. **Configurar ES Modules (Opcional)**:
   Para usar ES Modules (recomendado em 2025), adicione ao `package.json`:
   ```json
   "type": "module"
   ```
   Caso prefira CommonJS, pule esta etapa. O exemplo ser√° apresentado em ambos os formatos.

### Passo 2: Criar o Servidor HTTP

1. **Criar o Arquivo Principal**:
   Crie um arquivo `index.js` (ou `index.mjs` para ES Modules) na pasta do projeto.

2. **Implementar o Servidor**:
   - **CommonJS**:
     ```javascript
     // index.js
     const http = require('http');

     const hostname = '127.0.0.1';
     const port = 3000;

     const server = http.createServer((req, res) => {
       res.setHeader('Content-Type', 'text/plain; charset=utf-8');

       if (req.method === 'GET') {
         if (req.url === '/') {
           res.statusCode = 200;
           res.end('Bem-vindo √† p√°gina inicial!\n');
         } else if (req.url === '/about') {
           res.statusCode = 200;
           res.end('Sobre n√≥s: Somos uma equipe apaixonada por tecnologia!\n');
         } else if (req.url === '/contact') {
           res.statusCode = 200;
           res.end('Contato: Envie um e-mail para contato@exemplo.com\n');
         } else {
           res.statusCode = 404;
           res.end('P√°gina n√£o encontrada!\n');
         }
       } else {
         res.statusCode = 405;
         res.end('M√©todo n√£o permitido. Use GET.\n');
       }
     });

     server.listen(port, hostname, () => {
       console.log(`Servidor rodando em http://${hostname}:${port}/`);
     });
     ```

   - **ES Modules**:
     ```javascript
     // index.mjs
     import http from 'http';

     const hostname = '127.0.0.1';
     const port = 3000;

     const server = http.createServer((req, res) => {
       res.setHeader('Content-Type', 'text/plain; charset=utf-8');

       if (req.method === 'GET') {
         if (req.url === '/') {
           res.statusCode = 200;
           res.end('Bem-vindo √† p√°gina inicial!\n');
         } else if (req.url === '/about') {
           res.statusCode = 200;
           res.end('Sobre n√≥s: Somos uma equipe apaixonada por tecnologia!\n');
         } else if (req.url === '/contact') {
           res.statusCode = 200;
           res.end('Contato: Envie um e-mail para contato@exemplo.com\n');
         } else {
           res.statusCode = 404;
           res.end('P√°gina n√£o encontrada!\n');
         }
       } else {
         res.statusCode = 405;
         res.end('M√©todo n√£o permitido. Use GET.\n');
       }
     });

     server.listen(port, hostname, () => {
       console.log(`Servidor rodando em http://${hostname}:${port}/`);
     });
     ```

3. **Explica√ß√£o do C√≥digo**:
   - **Importa√ß√£o**: Usamos `require('http')` (CommonJS) ou `import http from 'http'` (ES Modules) para importar o m√≥dulo `http`.
   - **Configura√ß√£o**: Definimos `hostname` (`127.0.0.1`) e `port` (3000) para o servidor.
   - **Cria√ß√£o do Servidor**: `http.createServer` cria o servidor, recebendo uma fun√ß√£o de callback que lida com requisi√ß√µes (`req`) e respostas (`res`).
   - **Rotas**:
     - `req.method === 'GET'`: Verifica se a requisi√ß√£o √© do tipo GET.
     - `req.url`: Verifica a URL solicitada (`/`, `/about`, `/contact`).
     - Respostas com `res.statusCode` e `res.end` para cada rota.
     - Status 404 para rotas desconhecidas.
     - Status 405 para m√©todos n√£o suportados.
   - **Cabe√ßalho**: `Content-Type: text/plain; charset=utf-8` garante que o texto seja exibido corretamente, incluindo caracteres especiais.
   - **Inicializa√ß√£o**: `server.listen` inicia o servidor e exibe uma mensagem no console.

### Passo 3: Executar o Servidor

1. **Executar o Projeto**:
   ```bash
   npm start
   ```
   Ou, para desenvolvimento com rein√≠cio autom√°tico:
   ```bash
   npm run dev
   ```

2. **Testar as Rotas**:
   - Abra um navegador e acesse:
     - `http://localhost:3000/` ‚Üí "Bem-vindo √† p√°gina inicial!"
     - `http://localhost:3000/about` ‚Üí "Sobre n√≥s: Somos uma equipe apaixonada por tecnologia!"
     - `http://localhost:3000/contact` ‚Üí "Contato: Envie um e-mail para contato@exemplo.com"
     - `http://localhost:3000/qualquercoisa` ‚Üí "P√°gina n√£o encontrada!"
   - Use o **Postman** ou **curl** para testar:
     ```bash
     curl http://localhost:3000/
     curl http://localhost:3000/about
     curl http://localhost:3000/contact
     curl -X POST http://localhost:3000/ # Deve retornar "M√©todo n√£o permitido"
     ```

3. **Sa√≠da Esperada**:
   - No terminal: `Servidor rodando em http://127.0.0.1:3000/`.
   - No navegador ou curl: As mensagens correspondentes a cada rota.

### Passo 4: Boas Pr√°ticas

1. **Organiza√ß√£o do C√≥digo**:
   - Use constantes para valores fixos (`hostname`, `port`).
   - Adicione coment√°rios claros para facilitar a manuten√ß√£o.
   - Mantenha a l√≥gica de rotas simples e modular (futuras aulas usar√£o Express para isso).

2. **Tratamento de Erros**:
   - Inclu√≠mos status 404 e 405 para lidar com rotas inv√°lidas e m√©todos n√£o suportados.
   - Considere adicionar logs para erros (ex.: `console.error`).

3. **Versionamento**:
   - Inicialize um reposit√≥rio Git:
     ```bash
     git init
     git add .
     git commit -m "Servidor HTTP simples com rotas GET"
     ```
   - Crie um `.gitignore`:
     ```
     node_modules/
     ```

4. **Depura√ß√£o**:
   - Configure o VS Code para depura√ß√£o:
     ```json
     {
       "version": "0.2.0",
       "configurations": [
         {
           "type": "node",
           "request": "launch",
           "name": "Launch Program",
           "program": "${workspaceFolder}/index.js"
         }
       ]
     }
     ```
   - Adicione breakpoints para inspecionar `req.url` e `req.method`.

5. **Performance**:
   - Evite opera√ß√µes s√≠ncronas (ex.: `fs.readFileSync`) no servidor, pois bloqueiam o Event Loop.
   - Teste o servidor com m√∫ltiplas requisi√ß√µes simult√¢neas (ex.: usando ferramentas como `ab` ou `wrk`).

---

## Desafio Avan√ßado: Adicionar uma Rota que L√™ um Arquivo JSON

Neste desafio, voc√™ adicionar√° uma rota `/data` que l√™ um arquivo JSON do sistema de arquivos e retorna seu conte√∫do como resposta. Isso introduz o uso do m√≥dulo `fs` (File System) do Node.js e demonstra como integrar dados persistentes em um servidor HTTP.

### Passo 1: Criar o Arquivo JSON

1. Crie um arquivo `data.json` na raiz do projeto com o seguinte conte√∫do:
   ```json
   {
     "site": {
       "name": "Meu Site",
       "version": "1.0.0",
       "features": [
         "P√°gina inicial din√¢mica",
         "Se√ß√£o sobre a equipe",
         "Formul√°rio de contato"
       ]
     }
   }
   ```

2. Verifique se o arquivo est√° na mesma pasta que `index.js` (ou `index.mjs`).

### Passo 2: Atualizar o Servidor

Modifique o arquivo `index.js` (ou `index.mjs`) para incluir a rota `/data` que l√™ o arquivo JSON usando o m√≥dulo `fs`.

- **CommonJS**:
  ```javascript
  // index.js
  const http = require('http');
  const fs = require('fs').promises; // Usar vers√£o ass√≠ncrona do fs

  const hostname = '127.0.0.1';
  const port = 3000;

  const server = http.createServer(async (req, res) => {
    // Definir cabe√ßalho padr√£o
    res.setHeader('Content-Type', 'text/plain; charset=utf-8');

    if (req.method === 'GET') {
      if (req.url === '/') {
        res.statusCode = 200;
        res.end('Bem-vindo √† p√°gina inicial!\n');
      } else if (req.url === '/about') {
        res.statusCode = 200;
        res.end('Sobre n√≥s: Somos uma equipe apaixonada por tecnologia!\n');
      } else if (req.url === '/contact') {
        res.statusCode = 200;
        res.end('Contato: Envie um e-mail para contato@exemplo.com\n');
      } else if (req.url === '/data') {
        try {
          // Ler o arquivo JSON de forma ass√≠ncrona
          const data = await fs.readFile('./data.json', 'utf-8');
          // Alterar o Content-Type para JSON
          res.setHeader('Content-Type', 'application/json; charset=utf-8');
          res.statusCode = 200;
          res.end(data);
        } catch (error) {
          res.statusCode = 500;
          res.end('Erro ao ler o arquivo JSON: ' + error.message + '\n');
        }
      } else {
        res.statusCode = 404;
        res.end('P√°gina n√£o encontrada!\n');
      }
    } else {
      res.statusCode = 405;
      res.end('M√©todo n√£o permitido. Use GET.\n');
    }
  });

  server.listen(port, hostname, () => {
    console.log(`Servidor rodando em http://${hostname}:${port}/`);
  });
  ```

- **ES Modules**:
  ```javascript
  // index.mjs
  import http from 'http';
  import { promises as fs } from 'fs';

  const hostname = '127.0.0.1';
  const port = 3000;

  const server = http.createServer(async (req, res) => {
    res.setHeader('Content-Type', 'text/plain; charset=utf-8');

    if (req.method === 'GET') {
      if (req.url === '/') {
        res.statusCode = 200;
        res.end('Bem-vindo √† p√°gina inicial!\n');
      } else if (req.url === '/about') {
        res.statusCode = 200;
        res.end('Sobre n√≥s: Somos uma equipe apaixonada por tecnologia!\n');
      } else if (req.url === '/contact') {
        res.statusCode = 200;
        res.end('Contato: Envie um e-mail para contato@exemplo.com\n');
      } else if (req.url === '/data') {
        try {
          const data = await fs.readFile('./data.json', 'utf-8');
          res.setHeader('Content-Type', 'application/json; charset=utf-8');
          res.statusCode = 200;
          res.end(data);
        } catch (error) {
          res.statusCode = 500;
          res.end('Erro ao ler o arquivo JSON: ' + error.message + '\n');
        }
      } else {
        res.statusCode = 404;
        res.end('P√°gina n√£o encontrada!\n');
      }
    } else {
      res.statusCode = 405;
      res.end('M√©todo n√£o permitido. Use GET.\n');
    }
  });

  server.listen(port, hostname, () => {
    console.log(`Servidor rodando em http://${hostname}:${port}/`);
  });
  ```

### Passo 3: Explica√ß√£o do C√≥digo do Desafio

- **Importa√ß√£o do M√≥dulo `fs`**:
  - Usamos `fs.promises` (CommonJS: `require('fs').promises`, ES Modules: `import { promises as fs } from 'fs'`) para opera√ß√µes ass√≠ncronas, evitando bloqueios no Event Loop.
  - O m√≥dulo `fs` permite interagir com o sistema de arquivos (leitura, escrita, etc.).

- **Rota `/data`**:
  - Verifica se `req.url === '/data'`.
  - Usa `fs.readFile` para ler o arquivo `data.json` de forma ass√≠ncrona.
  - Define o `Content-Type` como `application/json` para indicar que a resposta √© JSON.
  - Retorna o conte√∫do do arquivo com `res.end(data)`.

- **Tratamento de Erros**:
  - Usa `try/catch` para capturar erros (ex.: arquivo n√£o encontrado).
  - Retorna status 500 com uma mensagem de erro se a leitura falhar.

- **Boas Pr√°ticas**:
  - Usa opera√ß√µes ass√≠ncronas (`fs.promises`) para manter o servidor n√£o-bloqueante.
  - Define o charset (`utf-8`) para suportar caracteres especiais.
  - Mant√©m o c√≥digo modular e comentado.

### Passo 4: Testar o Desafio

1. **Executar o Servidor**:
   ```bash
   npm run dev
   ```

2. **Testar a Rota `/data`**:
   - No navegador, acesse `http://localhost:3000/data`. Voc√™ ver√° o conte√∫do do `data.json`:
     ```json
     {
       "site": {
         "name": "Meu Site",
         "version": "1.0.0",
         "features": [
           "P√°gina inicial din√¢mica",
           "Se√ß√£o sobre a equipe",
           "Formul√°rio de contato"
         ]
       }
     }
     ```
   - Com curl:
     ```bash
     curl http://localhost:3000/data
     ```

3. **Testar Erros**:
   - Renomeie ou remova o arquivo `data.json` e acesse `http://localhost:3000/data`. Voc√™ ver√°:
     ```
     Erro ao ler o arquivo JSON: ENOENT: no such file or directory...
     ```

### Passo 5: Depura√ß√£o e Melhorias

1. **Depura√ß√£o**:
   - Adicione breakpoints no VS Code na linha do `fs.readFile` para inspecionar o conte√∫do de `data`.
   - Use `console.log` para depurar erros:
     ```javascript
     catch (error) {
       console.error('Erro ao ler JSON:', error);
       res.statusCode = 500;
       res.end('Erro ao ler o arquivo JSON: ' + error.message + '\n');
     }
     ```

2. **Melhorias Poss√≠veis**:
   - **Valida√ß√£o do JSON**: Parse o conte√∫do com `JSON.parse` para garantir que √© um JSON v√°lido:
     ```javascript
     const data = await fs.readFile('./data.json', 'utf-8');
     JSON.parse(data); // Lan√ßa erro se o JSON for inv√°lido
     ```
   - **Cache**: Armazene o conte√∫do do JSON em mem√≥ria para evitar leituras repetidas:
     ```javascript
     let cache = null;
     if (cache) {
       res.setHeader('Content-Type', 'application/json; charset=utf-8');
       res.statusCode = 200;
       res.end(cache);
     } else {
       const data = await fs.readFile('./data.json', 'utf-8');
       cache = data;
       res.setHeader('Content-Type', 'application/json; charset=utf-8');
       res.statusCode = 200;
       res.end(data);
     }
     ```
   - **Modulariza√ß√£o**: Mova a l√≥gica de rotas para um arquivo separado (explorado em m√≥dulos futuros com Express).

3. **Versionamento**:
   - Atualize o reposit√≥rio Git:
     ```bash
     git add .
     git commit -m "Adicionada rota /data para ler arquivo JSON"
     ```

---

## Conclus√£o

Neste projeto pr√°tico, voc√™:
- Criou um **servidor HTTP simples** com o m√≥dulo `http`, implementando rotas GET para `/`, `/about` e `/contact`.
- Lidaram com erros (404 para rotas inv√°lidas, 405 para m√©todos n√£o suportados).
- Completou o **Desafio Avan√ßado**, adicionando uma rota `/data` que l√™ um arquivo JSON com o m√≥dulo `fs.promises`.
- Aplicou boas pr√°ticas, como tratamento de erros, uso de opera√ß√µes ass√≠ncronas e versionamento com Git.

Este projeto consolida os fundamentos do Node.js, como o Event Loop, requisi√ß√µes HTTP e manipula√ß√£o de arquivos, preparando voc√™ para t√≥picos mais avan√ßados, como APIs com Express e integra√ß√£o com bancos de dados.

### Pr√≥ximos Passos

- Experimente adicionar mais rotas (ex.: `/users`, `/products`) ou suportar outros m√©todos HTTP (ex.: POST).
- Explore o m√≥dulo `fs` para outras opera√ß√µes (ex.: escrita de arquivos).
- Prepare-se para o **M√≥dulo 2**, onde abordaremos o **Sistema de Arquivos (fs module)** e opera√ß√µes ass√≠ncronas em profundidade.

Se tiver d√∫vidas, quiser mais exemplos ou precisar de ajustes no c√≥digo, √© s√≥ pedir! üöÄ
